//     Backbone State 0.0.1
//
//     by Ian Storm Taylor
//     https://github.com/ianstormtaylor/backbone-state
(function(e,t){if(e===undefined)throw new Error("Couldn't find Underscore");if(t===undefined)throw new Error("Couldn't find Backbone");t.mixin||(t.mixin={}),t.mixin.state=function(t){var n=this.prototype._configure;this.prototype._previousAttributes||this.prototype._prepareModel?this.prototype._configure=function(e,t){n.apply(this,arguments),this._configureStates(this.states||[],t||{})}:this.prototype._configure=function(e){n.apply(this,arguments),this._configureStates(this.states||[],this.options||{})},this.prototype._configureStates=function(t,n){e.isFunction(n)&&(n=n()),this.state={};for(var r=0,i;i=t[r];r++)this.state[i]=n[i]===!0},this.prototype.getState=function(e){return this.state[e]},this.prototype.setState=function(e,t){if(this.state[e]===t)return this;this.state[e]=t,this.$el&&this.$el.state&&this.$el.state(e,t),this.trigger("change:state:"+e,this,t),this.trigger("change:state",this,e,t)},this.prototype.toggleState=function(e,t){return this.setState(e,!this.getState(e))},this.prototype.onState=function(e,t,n,r){var i=this.getState(e);return i===t&&n.call(r,this,i),this.on("change:state:"+e,function(e,i){i===t&&n.apply(r,arguments)}),this},this.prototype.onceState=function(e,t,n,r){var i=this.getState(e);if(i===t)return n.call(r,this,i),this;var s=this,o=function(i,s){i.off("change:state:"+e,o,r),s===t&&n.apply(r,arguments)};return this.on("change:state:"+e,o,r),this}}})(_,Backbone);